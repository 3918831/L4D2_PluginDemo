# L4D2_PluginDemo
求生之路2插件示例

2025.7.28调试LOG:
CWeaponPortalgun是最小子类，无继承
实体与类之间关联宏：LINK_ENTITY_TO_CLASS
datamap.h：替换为portal sdk中的同名文件，否则BEGIN_DATADESC和DEFINE_FIELD有宏展开报错“初始值设定项值太多”错误（L4D2SDK中的datamap.h重命名为datamap.h.l4d2version，portal中的同名文件复制进SDK路径）
OBBMinsPreScaled和OBBMaxsPreScaled在L4D2SDK中不存在：src\game\shared\portal\portal_util_shared.cpp
CBaseEntity::IncrementInterpolationFrame(在src\game\server\baseentity.cpp)在L4D2SDK中不存在，但是使用的地方不多，如果游戏内确实不存在，调用可能崩溃，因此先注释掉该函数的所有调用；
src\public\vphysics_interface.h中，surfacesoundhandles_t的定义存在差异，导致src\game\shared\physics_shared.cpp中的实现被注销掉两行里面编译失败；
IVEngineServer的Timer接口在求生之路2中对应函数签名改为OBSOLETE_Time，作用相同，game\server\physics.cpp代码调用位置相应做出修改；
movevars_shared.cpp：L4D2SDK中缺少GetCurrentGravity函数，并且在使用两套sdk的情况下，编译阶段一旦包含L4D2的SDK后宏将起作用，便不会再重复包含PortalSDK的同名文件；
CSteamAPIContext类（src\public\steam\steam_api.h）的实现通过宏VERSION_SAFE_STEAM_API_INTERFACES隔离，但是调用和定义并没有隔离，造成编译找不到符号，此处L4D2SDK和PortalSDK两个文件是线上亦有差距。适配上选择通过相同的宏VERSION_SAFE_STEAM_API_INTERFACES隔离所有调用
CServerGameDLL对纯虚基类IServerGameDLL的实现不全，导致无法实例化对象，尝试拿IServerGameDLL的接口调用了没有覆写的方法ServerHibernationUpdate，确实可以调用，所以要对CServerGameDLL改造以实现基类的纯虚接口，所在文件在src\game\server\gameinterface.h
IVEngineServer基类的方法PEntityOfEntIndex已经被移除，参考：https://wiki.alliedmods.net/Porting_to_Left_4_Dead